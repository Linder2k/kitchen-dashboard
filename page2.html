<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Väderprognos för Norrtälje</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #000;
            color: orange;
            margin: 0;
            padding: 20px;
        }
        h1 {
            font-size: 3vw;
            margin-bottom: 10px;
        }
        #currentWeather {
            font-size: 2.5vw;
            margin-bottom: 30px;
        }
        #forecast {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .forecast-item {
            display: flex;
            align-items: center;
            gap: 20px;
            font-size: 2vw;
        }
        .forecast-item img {
            width: 50px;
            height: 50px;
        }
    </style>
</head>
<body>
    <h1>Vädret i Norrtälje</h1>
    <div id="currentWeather">Hämtar väderdata...</div>
    <div id="forecast"></div>

    <script>
        async function fetchWeather() {
            const url = 'https://opendata-download-metfcst.smhi.se/api/category/pmp3g/version/2/geotype/point/lon/18.7043/lat/59.7577/data.json';

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP-fel! Status: ${response.status}`);
                }
                const data = await response.json();
                displayWeather(data);
            } catch (error) {
                document.getElementById('currentWeather').innerText = 'Kunde inte hämta väderdata.';
                console.error('Fel vid hämtning av väderdata:', error);
            }
        }

        function displayWeather(data) {
            const currentWeatherElement = document.getElementById('currentWeather');
            const forecastElement = document.getElementById('forecast');
            const timeSeries = data.timeSeries;

            if (timeSeries && timeSeries.length > 0) {
                const now = new Date();

                // Hämta aktuell prognos
                const currentForecast = timeSeries.find(forecast => new Date(forecast.validTime) > now);
                if (currentForecast) {
                    const parameters = currentForecast.parameters;
                    const temperature = parameters.find(param => param.name === 't').values[0];
                    const windSpeed = parameters.find(param => param.name === 'ws').values[0];
                    const weatherSymbol = parameters.find(param => param.name === 'Wsymb2').values[0];

                    currentWeatherElement.innerHTML = `
                        <p>Just nu: ${temperature}°C, ${getWeatherDescription(weatherSymbol)}. Vind: ${windSpeed} m/s</p>
                    `;
                } else {
                    currentWeatherElement.innerText = 'Ingen aktuell väderprognos tillgänglig.';
                }

                // Hämta dagens prognos (nästa 12 timmar)
                const todayForecast = timeSeries.filter(forecast => {
                    const forecastTime = new Date(forecast.validTime);
                    return forecastTime.getDate() === now.getDate() && forecastTime > now;
                }).slice(0, 4); // Begränsa till max 4 prognoser (varje prognos är 3 timmar)

                forecastElement.innerHTML = ''; // Rensa tidigare prognos
                todayForecast.forEach(forecast => {
                    const forecastTime = new Date(forecast.validTime);
                    const parameters = forecast.parameters;
                    const temperature = parameters.find(param => param.name === 't').values[0];
                    const weatherSymbol = parameters.find(param => param.name === 'Wsymb2').values[0];

                    const timeString = forecastTime.toLocaleTimeString('sv-SE', { hour: '2-digit', minute: '2-digit' });
                    forecastElement.innerHTML += `
                        <div class="forecast-item">
                            <img src="https://www.smhi.se/assets/images/weather-symbols/${weatherSymbol}.svg" alt="Vädersymbol">
                            <span>${timeString}: ${temperature}°C, ${getWeatherDescription(weatherSymbol)}</span>
                        </div>
                    `;
                });
            } else {
                currentWeatherElement.innerText = 'Ingen väderdata tillgänglig.';
            }
        }

        function getWeatherDescription(symbol) {
            const descriptions = {
                1: 'Klart',
                2: 'Lätt molnighet',
                3: 'Halvklart',
                4: 'Molnigt',
                5: 'Mycket moln',
                6: 'Mulet',
                7: 'Dimma',
                8: 'Lätt regnskur',
                9: 'Regnskur',
                10: 'Kraftig regnskur',
                11: 'Åskskur',
                12: 'Lätt by av regn och snö',
                13: 'By av regn och snö',
                14: 'Kraftig by av regn och snö',
                15: 'Lätt snöby',
                16: 'Snöby',
                17: 'Kraftig snöby',
                18: 'Lätt regn',
                19: 'Regn',
                20: 'Kraftigt regn',
                21: 'Åska',
                22: 'Lätt snöblandat regn',
                23: 'Snöblandat regn',
                24: 'Kraftigt snöblandat regn',
                25: 'Lätt snöfall',
                26: 'Snöfall',
                27: 'Kraftigt snöfall'
            };
            return descriptions[symbol] || 'Okänt väder';
        }

        fetchWeather();
        setInterval(fetchWeather, 1800000); // Uppdatera varje 30:e minut
    </script>
</body>
</html>
